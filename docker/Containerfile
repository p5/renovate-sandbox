FROM fedora:40

# renovate: datasource=git-refs depName=whisper.cpp packageName=https://github.com/ggerganov/whisper.cpp gitRef=master type=digest
ARG WHISPER_CPP_COMMIT=d65786ea540a5aef21f67cacfa6f134097727780

# renovate: datasource=github-releases depName=ggerganov/whisper.cpp
ARG WHISPER_CPP_VERSION=v1.6.1

RUN git clone https://github.com/ggerganov/whisper.cpp.git && \
    cd whisper.cpp && \
    git reset --hard ${WHISPER_CPP_COMMIT} && \
    make -j $(nproc) && \
    mv main /usr/bin/whisper-main && \
    mv server /usr/bin/whisper-server && \
    cd / && \
    rm -rf whisper.cpp
